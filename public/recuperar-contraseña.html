<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recuperar Contrase√±a - ArtFlow</title>
  <link rel="stylesheet" href="public/assets/css/base.css" />
  <link rel="stylesheet" href="public/assets/css/recuperar.css" />
</head>
<body>
  <div class="layout">
    <!-- Sidebar izquierda -->
    <aside class="sidebar">
      <div id="sidebar-placeholder"></div>
    </aside>

    <!-- Contenido principal -->
    <main class="main-content">
      <!-- Topbar del buscador -->
      <div id="topbar-placeholder"></div>

      <section class="recovery-section">
        <h2>Recuperar contrase√±a</h2>

        <!-- Paso 1: Ingresar correo y usuario -->
        <form id="step1" class="recovery-form active">
          <label for="username">Usuario</label>
          <input type="text" id="username" name="username" required />

          <label for="email">Correo registrado</label>
          <input type="email" id="email" name="email" required />

          <button type="submit">Enviar c√≥digo</button>
        </form>

        <!-- Paso 2: Ingresar c√≥digo -->
        <form id="step2" class="recovery-form hidden">
          <label for="code">C√≥digo recibido</label>
          <input type="text" id="code" name="code" maxlength="6" required />

          <button type="submit">Verificar c√≥digo</button>
        </form>

        <!-- Paso 3: Nueva contrase√±a -->
        <form id="step3" class="recovery-form hidden">
          <label for="new-password">Nueva contrase√±a</label>
          <input type="password" id="new-password" name="new-password" required placeholder="********"/>

          <label for="confirm-password">Confirmar contrase√±a</label>
          <input type="password" id="confirm-password" name="confirm-password" required placeholder="********"/>

          <p class="password-rules">M√≠nimo 8 caracteres, incluir may√∫sculas, min√∫sculas, n√∫meros y s√≠mbolos.</p>

          <button type="submit">Cambiar contrase√±a</button>
        </form>
      </section>
    </main>
  </div>

  <!-- Cargar sidebar -->
  <script type="module">
    import { loadSidebar } from '/public/assets/js/sidebar.js';
    loadSidebar();
  </script>

  <!-- Cargar topbar -->
  <script type="module">
    import { loadTopbar } from '/public/assets/js/topbar.js';
    loadTopbar();
  </script>

  <!-- Script de pasos (opcional si quieres usar JS) -->
  <script type="module">
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');

    step1.addEventListener('submit', (e) => {
      e.preventDefault();
      // Simular env√≠o de c√≥digo
      step1.classList.add('hidden');
      step2.classList.remove('hidden');
    });

    step2.addEventListener('submit', (e) => {
      e.preventDefault();
      // Simular verificaci√≥n de c√≥digo
      step2.classList.add('hidden');
      step3.classList.remove('hidden');
    });

    step3.addEventListener('submit', (e) => {
      e.preventDefault();
      // Simular cambio de contrase√±a
      alert('¬°Contrase√±a actualizada!');
    });
  </script>
</body>
</html>

<!-- 
üìå Variables necesarias en backend y l√≥gica:
- username (string): nombre del usuario registrado
- email (string): email vinculado a la cuenta
- recoveryCode (string): c√≥digo generado temporalmente y enviado al correo
- expirationTime (Date): marca de tiempo en que expira el c√≥digo (30 minutos)
- newPassword (string): nueva contrase√±a enviada tras validaci√≥n

üìå Procesos backend con MongoDB y Fastify:
1. POST /api/v1/auth/send-recovery-code
   - Body: { username, email }
   - Acciones:
     ‚Ä¢ Validar que el email y usuario existen
     ‚Ä¢ Generar c√≥digo de 6 d√≠gitos aleatorio
     ‚Ä¢ Guardarlo temporalmente en MongoDB con fecha de expiraci√≥n
     ‚Ä¢ Enviar el c√≥digo por correo

2. POST /api/v1/auth/verify-code
   - Body: { username, code }
   - Validar que el c√≥digo es correcto y no ha expirado

3. POST /api/v1/auth/reset-password
   - Body: { username, newPassword }
   - Validar seguridad de contrase√±a
   - Hashear y actualizar contrase√±a en MongoDB
-->
